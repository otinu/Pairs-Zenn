---
title: "Gmailã«å±Šãèªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’GmailAPIã‹ã‚‰è‡ªå‹•ç¢ºèªã—ãŸã„"
emoji: "ğŸ“¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Python", "GmailAPI", "è‡ªå‹•åŒ–"]
published: true
---

# ã”æŒ¨æ‹¶

ã¯ã˜ã‚ã¾ã—ã¦ï¼ ãŠãƒãƒŒã¨ç”³ã—ã¾ã™ã€‚
æ™®æ®µã¯ Java ã«è§¦ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ãŒã€å€‹äººã§ã¯ Python ã‚„ JS ãªã©è‡ªç”±ã«ã‚„ã£ã¦ã„ã¾ã™ã€‚

ä½•ã‹ã—ã‚‰ã‚„ã£ã¦ã‚‹ã“ã¨ã®åŒºåˆ‡ã‚ŠãŒã¤ã„ãŸã‚Šã€ãŠã‚‚ã—ã‚ãã†ãªãƒã‚¿ãŒã¾ã¨ã¾ã£ãŸã‚Šã—ãŸéš›ã«è¨˜äº‹ãªã©ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã—ã¦ã„ããŸã„ã¨è€ƒãˆã¦ã¾ã™ã€‚

èª°ã‹ã®è¨˜äº‹ã«åŠ©ã‘ã‚‰ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã€è‡ªåˆ†ã®è¨˜äº‹ã‚‚å¾®åŠ›ãªãŒã‚‰èª°ã‹ã®+@ã«ãªã‚‹ã¨ã†ã‚Œã—ã„ã§ã™ã€‚
ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚

# GmailAPI ã®è¨­å®š

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒåˆ†ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚
https://developers.google.com/gmail/api/quickstart/python?hl=ja

# GmailAPI ã§ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®šã™ã‚‹

## ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã® ID ãŒåˆ†ã‹ã‚‰ãªã„

ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¦

```
GMAIL = discovery.build("gmail", "v1", http=creds.authorize(Http()))
user_id = "me"
first_label = "INBOX"
second_label = "UNREAD"

GMAIL.list(userId="me", labelIds=[first_label, second_label])
```

ã€ŒINBOXã€ã‚„ã€ŒUNREADã€ãªã©ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ã€å°‘ã—èª¿ã¹ã‚Œã°ä½•ã‚’å…¥ã‚Œã‚‹ã¹ãã‹ã‚ã‚‹ç¨‹åº¦åˆ†ã‹ã‚Šã¾ã—ãŸã€‚

ãŸã ã€**è‡ªåˆ†ã§ä½œæˆã—ãŸãƒ©ãƒ™ãƒ«ã®æŒ‡å®šãŒã§ããšã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹**ã¨ã„ã†å•é¡Œã«ã‚ãŸã‚Šã¾ã—ãŸã€‚
å…·ä½“çš„ã«ã¯æ¬¡ã®ã‚ˆã†ãªæµã‚Œã§ã™ã€‚

1. Gmail ä¸Šã§ã€Œtestã€ã¨ã„ã†ãƒ©ãƒ™ãƒ«ã‚’ä½œã£ã¦ã€ç‹™ã„æ’ƒã¡ã—ãŸã„ãƒ¡ãƒ¼ãƒ«ã«ã ã‘ãƒ©ãƒ™ãƒ«è¿½åŠ 
2. ã‚³ãƒ¼ãƒ‰ä¸Šã§ã€Œfirst_label = 'test'ã€ã¨è¨˜è¿°
3. å®Ÿè¡Œã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼

ã©ã†ã‚„ã‚‰ã€**first_label = 'test'(ç‹¬è‡ªãƒ©ãƒ™ãƒ«)ã® ID** ã¨è¨˜è¿°ã™ã‚‹ã¿ãŸã„ã§ã™ã€‚
Gmail ã®ç”»é¢ã‹ã‚‰ç¢ºèªã§ããªã„â€¦ã€‚

## ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã® ID ã®ç¢ºèªæ–¹æ³•

**å‰æã¨ã—ã¦ã€GmailAPI ãŒå‹•ã‹ã›ã‚‹ç’°å¢ƒã«ãªã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**
ç¢ºèªæ–¹æ³•ã«ã€å…ˆã»ã©ã®å…¬å¼ã‚µã‚¤ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚
https://developers.google.com/gmail/api/quickstart/python?hl=ja

ã‚µã‚¤ãƒˆå¾ŒåŠã«å‡ºã¦ãã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°ã‚’

```
for label in labels:
    print(label['name'])
```

æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

```
for label in labels:
    print(label)
```

å¤‰æ›´å¾Œã«å®Ÿè¡Œã™ã‚‹ã¨ã€å…¨ãƒ©ãƒ™ãƒ«(10 ä»¶å‰å¾Œ?)ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ãŒã€æ¬¡ã®ã‚ˆã†ãªå‡ºåŠ›å½¢å¼ã«ãªã‚‹ã®ã§ã€ç›®è¦–ã§ç°¡å˜ã«æ¢ã›ã¾ã—ãŸã€‚
{'id': 'ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã® ID', 'name': 'ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã®åç§°', 'type': 'user'}

ã‚ã¨ã¯ã€è©²å½“ã® ID ã‚’å…ˆã»ã©ã®ã‚³ãƒ¼ãƒ‰å†…ã«å«ã‚ã¾ã™ã€‚

```
GMAIL = discovery.build("gmail", "v1", http=creds.authorize(Http()))
user_id = "me"
first_label = "Label_12345678987654321" # ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã®IDã§ç½®ãæ›ãˆ
second_label = "UNREAD"

GMAIL.list(userId="me", labelIds=[first_label, second_label])
```

API å®Ÿè¡Œæ™‚ã¯æ¬¡ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¾ã—ãŸã€‚

```
mylabel_msgs = (
    GMAIL.users()
    .messages()
    .list(userId=user_id, labelIds=[label_id_one, label_id_two])
    .execute()
)
```

# ã‚³ãƒ¼ãƒ‰å…¨ä½“

### ã‚³ãƒ¼ãƒ‰æ¦‚è¦

ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®èªè¨¼ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚
èªè¨¼ãƒ¡ãƒ¼ãƒ«ãŒè¤‡æ•°ä»¶å±Šã„ã¦ã„ã¦ã‚‚ã€æœ€æ–°ã® 1 ä»¶ã®èªè¨¼ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’å–å¾—ã—ã¾ã™ã€‚

### ä¸‹æº–å‚™

å¤§ã¾ã‹ã«æ¬¡ã®ã‚ˆã†ãªé †ç•ªã§ä¸‹æº–å‚™ã‚’ã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¾ã™ã€‚

1. GmailAPI ã®è¨­å®š
2. å¯¾è±¡ã®èªè¨¼ãƒ¡ãƒ¼ãƒ«ã«ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã‚’è¨­å®š
   âš ï¸GmailAPI ã®è¨­å®šã¨èªè¨¼ãƒ¡ãƒ¼ãƒ«ã‚’å—ã‘å–ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯åŒã˜ã‚‚ã®ã‚’ä½¿ã†å‰æã§ã™

### ã‚³ãƒ¼ãƒ‰

```
from apiclient import discovery
from httplib2 import Http
from oauth2client import file, client, tools

# ç‹¬è‡ªãƒ©ãƒ™ãƒ«ã®IDã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†
import my_confidential


def get_authentication_code() -> str:
    """
    ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®èªè¨¼ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹

    Args:
        None

    Returns:
        str: èªè¨¼ã‚³ãƒ¼ãƒ‰
    """

    SCOPES = "https://www.googleapis.com/auth/gmail.modify"
    store = file.Storage("storage.json")
    creds = store.get()
    if not creds or creds.invalid:
        flow = client.flow_from_clientsecrets("credentials.json", SCOPES)
        creds = tools.run_flow(flow, store)
    GMAIL = discovery.build("gmail", "v1", http=creds.authorize(Http()))
    user_id = "me"
    label_id_one = "INBOX"
    label_id_two = my_confidential.Information.LABEL
    mylabel_msgs = (
        GMAIL.users()
        .messages()
        .list(userId=user_id, labelIds=[label_id_one, label_id_two])
        .execute()
    )
    mssg_list = mylabel_msgs["messages"]
    m_id = mssg_list[0]["id"]  # å¯¾è±¡ãƒ©ãƒ™ãƒ«ã®æœ€æ–°ãƒ¡ãƒ¼ãƒ«ã ã‘å–å¾—
    message = GMAIL.users().messages().get(userId=user_id, id=m_id).execute()
    mail_body = message["snippet"]

    return mail_body[6:12]
```
